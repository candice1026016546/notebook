---
layout: post
title: 优先级与链接属性，详解 static 与 extern 关键字
category: C/C++
tag: C语言
---

* toc
{:toc}

在C程序中，当同一个变量或函数出现在多个地方或者同一个变量或函数存在于多个源文件中的时候，他们是表示同一个实体呢还是表示不同实体？且看下面详细讲解：

**先简要介绍C语言的几种作用域**

# 1.作用域：

可以归纳为下面几种作用域：

## 1\. 代码块作用域

以一对闭合花括号( { } )包围的代码称为代码块，代码块中还可以嵌套代码块。所以嵌套越深的代码块中定义的变量会覆盖掉较浅代码块中定义的变量；举例如下：

```c
#include <stdio.h>

int a=10;  //全局变量

void fun(){
    printf("%d\n",a);
    int a=20;
    {
        int a=30;
        printf("%d\n",a);
    }
    printf("%d\n",a);
}

int main(){
    fun();
    return 0;
}

输出结果：
10
30
20
```

## 2\. 文件作用域

在所有的代码块中声明的变量或者函数都有文件作用域，从声明处到文件结尾处都可以访问该声明。

另外通过`#include` 这样的预编译指令包含其他文件，就好像被包含文件是直接写在该文件中的一样，所以他的作用域并不局限于头文件中，而在包含它的文件中依旧可以访问到。

## 3\. 原型作用域

在声明函数的时候，我们并不需要给定参数名，只需要表明参数类型就可以了。所以如下声明中的 a 和 b 可有可无，在后面调用该函数的时候传递的参数名不需要与定义时的参数名一致。其实，在这里唯一需要注意的是，同一个函数的声明中，不同的参数不可以使用同一个名字。即不可为`void fun(int a,int a)`。

```c
void fun(int a,int b);
```

## 4\. 函数作用域

这个很好理解，它是针对`goto`关键字来说的，在一个函数的不可以使用相同的语句标签。

至此单个文件的问题算是解决了，下面且看多个文件，但在此前需要提提链接属性。

# 2.链接属性

首先需要提出三种链接属性,每个变量或函数都有自己的链接属性，不同的链接属性决定了如何处理在不同文件中出现的相同声明。

## 1\. 外部链接(external)

外部链接属性说明无论在多少个文件声明多少次，位于不同源文件中的变量或函数都指的是同一个实体。

## 2\. 内部链接(internal)

内部链接表示在同一个源文件中的声明是指向同一实体，但位于不同源文件的多个声明属于不同的实体。

## 3\. 无(none)

没有链接属性指，多个声明分别表示不同的实体。

下面举例说明，三种属性的得来方式：

```c
typedef char *ptrToChar
int a;
int b(int c){
    int d;
    int e(int f);
}
static int g;
```

- **外部链接**：全局变量，以及函数的链接属性为外部链接,即以上代码中的 a ,b,e 的链接属性为外部链接。

- **内部链接** ：使用`static` 修饰正常情况下为外部链接的变量可以是其链接属性变为内部链接,即 g 。

- **无** ： 而代码块中定于的变量的链接属性为无( none )，除去外部链接与内部链接，其余的链接属性皆为无。

**而这些属性有说明什么呢？这里需要引出两个关键字。**

## extern关键字

有时候我们希望使用其他源文件中定义的变量或者函数。比如下面的两个源文件，hello.c 中定义了一个字符串，而在print.c中需要打印这个字符串：

```c
/*hello.c*/
char *a = "hello,world!\n";
```

```c
/*print.c*/
#include <stdio.h>
char *a;
int main(){
    printf("%s",a);   
    return 0;
}
```

使用命令行`gcc hello.c print.c` 编译后打印出`hello,world!` 。在这里 a 具有外部链接属性，所以在`print.c` 中声明的 a 实际上与 `hello.c` 中的 a 是同一个实体。

但是有时候为了表明 a 是在其他源文件中定义的我们在其前面加上 `extern` 。但要明白不加该关键字也可以。为了程序的易读性建议加上。故修改如下：

```c
/*print.c*/

#include <stdio.h>

extern char *a;

int main(){
    printf("%s",a);
    return 0;
}
```

在代码块中的变量前加上`extern`关键字是说明是引用的全局变量，而非在此创建一个变量。如果此处不加`extern`将会创建一个临时变量，并覆盖掉全局变量。

## static关键字

static 关键字有三种用法，说明如下：

```c
static int b;
```

- 1.如果没有`static`关键字，那么变量`b`则是外部链接，加上`static`表明该变量为内部链接。所以在其他文件中遇到出现的 b 不再是此文件中声明的变量 b 。

```c
static void fun();
```

- 2.而在函数前面加上 `static` 则指明该函数只能在该文件中被调用。

```c
void count(){
    static int num=0;
    num++;
}
```

- 3.在代码块中声明的变量前加`static`。要注意这里若不加`static` 那么num的链接属性是 无( none ) 。这实际上是将该变量的存储类型修改为了静态存储类型。该变量在程序开始前被创建，在整个程序运行过程中一直存在，直到程序执行完毕。但是该变量能在该代码块中被调用。关于存储类型详见[C语言中变量的存储类型与初始化](/store-type)。

# 3\. 总结

在单个文件中使用变量的时候要牢牢记住优先级。

面对多个文件要理解关键字 static 与 extern 。这两个关键字只是使用在声明变量的时候。

extern 用于指明该变量为外部链接，实际上可以有可无，但加上便于阅读。

static 有三种用法：

1. 用在全局变量前，表示该变量的属性为内部链接，即只能在该文件中调用。
2. 用在函数前，表示该函数只能在该文件中被调用。
3. 用在函数的代码块中，这实际上是声明了一个静态变量。
